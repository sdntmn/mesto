(()=>{"use strict";function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var t=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this._url=e.baseUrl,this._headers=e.headers}var n,r;return n=t,(r=[{key:"_checkResponsPromise",value:function(e){return e.ok?e.json():Promise.reject(console.log("Ошибка № ".concat(e.status,"  Текст ошибки: ").concat(e.statusText)))}},{key:"getInitialCards",value:function(){return fetch(this._url+"/cards",{headers:this._headers}).then(this._checkResponsPromise)}},{key:"setCardUser",value:function(e){return fetch(this._url+"/cards",{method:"POST",headers:this._headers,body:JSON.stringify({name:e.name,link:e.link})}).then(this._checkResponsPromise)}},{key:"getDataUser",value:function(e){return fetch(this._url+"/users/me ",{headers:this._headers,body:JSON.stringify(e)}).then(this._checkResponsPromise)}},{key:"renderFirstData",value:function(){return Promise.All([this.getDataUser()],[this.getInitialCards()])}},{key:"getLikeCardId",value:function(e,t){return fetch(this._url+"/cards/likes/".concat(e),{method:t?"DELETE":"PUT",headers:this._headers}).then(this._checkResponsPromise)}},{key:"changeDataUser",value:function(e){return fetch(this._url+"/users/me ",{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e.name,about:e.about})}).then(this._checkResponsPromise)}},{key:"changeAvatarUser",value:function(e){return console.log(e.avatar),fetch(this._url+"/users/me/avatar",{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e.avatar})}).then(this._checkResponsPromise)}},{key:"deleteCardUser",value:function(e){return fetch(this._url+"/cards/".concat(e),{method:"DELETE",headers:this._headers,body:JSON.stringify({_id:e})}).then(this._checkResponsPromise)}}])&&e(n.prototype,r),t}();function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var o=function(){function e(t,n,o,i,u){var c=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),r(this,"_data",void 0),r(this,"_templateSelector",void 0),r(this,"_handleCardClick",void 0),r(this,"_getTemplate",(function(){return c._elementTemplate.content.querySelector(".element").cloneNode(!0)})),r(this,"onDelete",(function(){c._element.remove(),c._element=null})),this._data=t,this.idCard=t.owner._id,this._likesArr=t.likes,this._elementTemplate=document.querySelector(n),this._handleCardClick=o,this._handleDeleteCard=i,this._handleClickLike=u}var t,o;return t=e,(o=[{key:"generateCard",value:function(e){return this._element=this._getTemplate(),this._elementImg=this._element.querySelector(".element__img"),this._elementDel=this._element.querySelector(".element__trash"),this._element.querySelector(".element__number-likes").textContent=this._likesArr.length,e===this.idCard&&(this._elementDel=this._elementDel.classList.add("element_is-visible")),this._likesArr.find((function(t){return e===t._id}))&&this._element.querySelector(".element__like").classList.add("element__like_active"),this._listenerLike(),this._setEventListeners(),this._elementImg.alt="Фото. ".concat(this._data.name),this._element.querySelector(".element__name-mesto").textContent=this._data.name,this._elementImg.src=this._data.link,this._element}},{key:"checkLike",value:function(e){return Boolean(this._likesArr.find((function(t){return e===t._id})))}},{key:"_likeClick",value:function(){this._element.querySelector(".element__like").classList.toggle("element__like_active")}},{key:"calcLike",value:function(e){this._likesArr=e.likes,this._element.querySelector(".element__number-likes").textContent=e.likes.length,!1===this.checkLike()&&this._likeClick()}},{key:"_listenerLike",value:function(){var e=this;this._element.querySelector(".element__like").addEventListener("click",(function(){e._handleClickLike(e)}))}},{key:"_setEventListeners",value:function(){var e=this;this._element.querySelector(".element__trash").addEventListener("click",(function(){e._handleDeleteCard(e)})),this._element.querySelector(".element__img").addEventListener("click",(function(){e._handleCardClick()}))}}])&&n(t.prototype,o),e}();function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var c=function(){function e(t,n){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),u(this,"_hideInputError",(function(){var e=r._formSelector.querySelector(".".concat(r.input.id,"-error"));r.input.classList.remove(r._inputErrorClass),r.input.classList.remove(r._errorClass),e.textContent=""})),u(this,"_checkInputValidity",(function(e){r.input=e,e.validity.valid?r._hideInputError():r._showInputError()})),u(this,"_hasInvalidInput",(function(){return r._inputList.some((function(e){return!e.validity.valid}))})),u(this,"_toggleButtonState",(function(){r._hasInvalidInput()?r._buttonElement.disabled=!0:r._buttonElement.disabled=!1})),u(this,"_setEventListeners",(function(){r._inputList.forEach((function(e){e.addEventListener("input",(function(){r._checkInputValidity(e),r._toggleButtonState()}))}))})),this._formSelector=document.querySelector(n),this._inputSelector=t.inputSelector,this._button=t.submitButtonSelector,this._inactiveButtonClass=t.inactiveButtonClass,this._inputList=Array.from(this._formSelector.querySelectorAll(this._inputSelector)),this._inputErrorClass=t.inputErrorClass,this._errorClass=t.errorClass,this._buttonElement=this._formSelector.querySelector(this._button)}var t,n;return t=e,(n=[{key:"_showInputError",value:function(){var e=this._formSelector.querySelector(".".concat(this.input.id,"-error"));this.input.classList.add(this._inputErrorClass),e.textContent=this.input.validationMessage,this.input.classList.add(this._errorClass)}},{key:"enableValidation",value:function(){this._setEventListeners()}},{key:"resetInputError",value:function(){var e=this;this._inputList.forEach((function(t){e._hideInputError(e._checkInputValidity(t))}))}},{key:"disableButtonElement",value:function(){this._buttonElement.disabled=!0}}])&&i(t.prototype,n),e}();function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var l=function(){function e(t,n){var r=this,o=t.renderer;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),s(this,"_items",void 0),s(this,"_renderer",void 0),s(this,"_containerSelector",void 0),s(this,"addItem",(function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];t?r._containerSelector.append(e):r._containerSelector.prepend(e)})),this._renderer=o,this._containerSelector=document.querySelector(n)}var t,n;return t=e,(n=[{key:"renderItems",value:function(e){var t=this;e.forEach((function(e){t._renderer(e)}))}}])&&a(t.prototype,n),e}();function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var p=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._selectorPopup=t,this._handleEscClose=this._handleEscClose.bind(this)}var t,n;return t=e,(n=[{key:"open",value:function(){this._selectorPopup.classList.add("popup_is-opened"),document.addEventListener("keydown",this._handleEscClose)}},{key:"close",value:function(){this._selectorPopup.classList.remove("popup_is-opened"),document.removeEventListener("keydown",this._handleEscClose)}},{key:"_handleEscClose",value:function(e){"Escape"===e.key&&this.close()}},{key:"setEventListeners",value:function(){var e=this;this._selectorPopup.addEventListener("click",(function(t){(t.target.classList.contains("popup__close")||t.target===t.currentTarget)&&e.close()}))}}])&&f(t.prototype,n),e}();function h(e){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function d(e,t,n){return(d="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=b(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function m(e,t){return!t||"object"!==h(t)&&"function"!=typeof t?v(e):t}function v(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function b(e){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var g=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&y(e,t)}(u,e);var t,n,r,o,i=(r=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=b(r);if(o){var n=b(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return m(this,e)});function u(e,t){var n,r=t.submit;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),(n=i.call(this,e))._submit=r,n._form=e.querySelector(".popup__form"),n._getInputValues=n._getInputValues.bind(v(n)),n._popupButton=n._form.querySelector(".popup__button"),n._popupButtonText=n._popupButton.textContent,n}return t=u,(n=[{key:"_getInputValues",value:function(){var e=this;return this._inputList=this._form.querySelectorAll(".popup__input"),this.data={},this._inputList.forEach((function(t){e.data[t.name]=t.value})),this.data}},{key:"renderLoading",value:function(e){this._popupButton.textContent=e?"Сохранение...":this._popupButtonText}},{key:"setEventListeners",value:function(){var e=this;d(b(u.prototype),"setEventListeners",this).call(this),this._form.addEventListener("submit",(function(t){t.preventDefault(),e._submit(e._getInputValues())}))}},{key:"close",value:function(){d(b(u.prototype),"close",this).call(this),this._form.reset()}}])&&_(t.prototype,n),u}(p);function k(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var S=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._selectorNameUser=t,this._selectorInfo=n,this._selectorAvatar=r}var t,n;return t=e,(n=[{key:"setUserInfo",value:function(e){this._selectorNameUser.textContent=e.name,this._selectorInfo.textContent=e.about,this.setUserAvatar(e)}},{key:"setUserAvatar",value:function(e){this._selectorAvatar.src=e.avatar}},{key:"getUserInfo",value:function(){return{name:this._selectorNameUser.textContent,about:this._selectorInfo.textContent}}},{key:"getUserAvatar",value:function(){return{avatar:this._selectorAvatar.textContent}}}])&&k(t.prototype,n),e}();function E(e){return(E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function C(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function w(e,t,n){return(w="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=P(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function L(e,t){return(L=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function O(e,t){return!t||"object"!==E(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function P(e){return(P=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var I=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&L(e,t)}(u,e);var t,n,r,o,i=(r=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=P(r);if(o){var n=P(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return O(this,e)});function u(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),(t=i.call(this,e))._popupFoto=e,t._popupImg=t._popupFoto.querySelector(".popup__img"),t._popupImgName=t._popupFoto.querySelector(".popup__img-name"),t}return t=u,(n=[{key:"open",value:function(e){this._popupImg.src=e.link,this._popupImg.alt="Фото. ".concat(e.name),this._popupImgName.textContent=e.name,w(P(u.prototype),"open",this).call(this)}}])&&C(t.prototype,n),u}(p);function j(e){return(j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function q(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function R(e,t,n){return(R="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=D(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function T(e,t){return(T=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function U(e,t){return!t||"object"!==j(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function D(e){return(D=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var x=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&T(e,t)}(u,e);var t,n,r,o,i=(r=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=D(r);if(o){var n=D(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return U(this,e)});function u(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),(t=i.call(this,e))._form=e.querySelector(".popup__form"),t._handleDeleteCard=null,t}return t=u,(n=[{key:"changeFunction",value:function(e){this._handleDeleteCard=e}},{key:"setEventListeners",value:function(){var e=this;R(D(u.prototype),"setEventListeners",this).call(this),this._form.addEventListener("submit",(function(t){t.preventDefault(),e._handleDeleteCard()}))}}])&&q(t.prototype,n),u}(p),B=document.querySelector(".profile"),A=document.querySelector("#popup_form_mesto"),N=document.querySelector("#popup_foto_mesto"),V=document.querySelector("#popup_form_avatar"),F=document.querySelector("#popup_delete_card"),J=B.querySelector(".profile__opened"),z=B.querySelector(".profile__button"),H=B.querySelector(".profile__opened-avatar"),M=document.querySelector("#popup_form_profile"),G=M.querySelector(".popup__input_value_name"),K=M.querySelector(".popup__input_value_job"),Q=B.querySelector(".profile__specialization"),W=B.querySelector(".profile__avatar"),X=B.querySelector(".profile__item-info"),Y={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:".popup__button:disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error"},Z=new t({baseUrl:"https://mesto.nomoreparties.co/v1/cohort-26",headers:{authorization:"6be9abb7-ced4-4a7c-8643-2f58993788b8","Content-Type":"application/json"}}),$=new l({renderer:function(e){$.addItem(oe(e))}},".elements"),ee=null;Z.getDataUser().then((function(e){ee=e._id,te.setUserInfo(e),te.setUserAvatar(e)})).catch((function(e){console.log("Ошибка получения данных о пользователе ".concat(e))}));var te=new S(X,Q,W),ne=new I(N);ne.setEventListeners();var re=new x(F);function oe(e){var t=new o(e,"#template-element",(function(){ne.open(e)}),(function(){re.open(),re.changeFunction((function(){Z.deleteCardUser(e._id).then((function(){t.onDelete(),re.close()})).catch((function(e){console.log("Ошибка удаления карточки ".concat(e))}))}))}),(function(){Z.getLikeCardId(e._id,t.checkLike(ee)).then((function(e){console.log(e),t.calcLike(e)})).catch((function(e){console.log("Ошибка данных лайков ".concat(e))}))}));return t.generateCard(ee)}re.setEventListeners(),Z.getInitialCards().then((function(e){$.renderItems(e)})).catch((function(e){console.log("Ошибка получения данных карточки ".concat(e))}));var ie=new g(A,{submit:function(e){var t=e;ie.renderLoading(!0),Z.setCardUser(t).then((function(e){$.addItem(oe(e),!1),ie.close()})).catch((function(e){console.log("Ошибка получения данных карточки ".concat(e))})).finally((function(){return ie.renderLoading(!1)}))}}),ue=new g(M,{submit:function(e){ue.renderLoading(!0),Z.changeDataUser(e).then((function(e){console.log(e),te.setUserInfo(e),ue.close()})).catch((function(e){return console.log("Ошибка данных ".concat(e))})).finally((function(){return ue.renderLoading(!1)}))}}),ce=new g(V,{submit:function(e){ce.renderLoading(!0),Z.changeAvatarUser(e).then((function(e){te.setUserAvatar(e),ce.close()})).catch((function(e){return console.log("Ошибка данных ".concat(e))})).finally((function(){return ce.renderLoading(!1)}))}});J.addEventListener("click",(function(){se.resetInputError();var e=te.getUserInfo();K.value=e.about,G.value=e.name,ue.open()})),H.addEventListener("click",(function(){le.resetInputError(),le.disableButtonElement(),ce.open()})),z.addEventListener("click",(function(){ae.resetInputError(),ae.disableButtonElement(),ie.open()}));var ae=new c(Y,"#form_mesto"),se=new c(Y,"#form_profile"),le=new c(Y,"#form_avatar");ce.setEventListeners(le.enableValidation()),ue.setEventListeners(se.enableValidation()),ie.setEventListeners(ae.enableValidation())})();